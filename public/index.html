<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Smark Config</title>

    <script defer src="/__/firebase/9.6.6/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/9.6.6/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-database-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-firestore-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-messaging-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-storage-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-analytics-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-remote-config-compat.js"></script>
    <script defer src="/__/firebase/9.6.6/firebase-performance-compat.js"></script>
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

    <style media="screen">
        body {
            background: #ECEFF1;
            color: rgba(0, 0, 0, 0.87);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 0;
        }

        #message {
            background: white;
            max-width: 400px;
            margin: 100px auto 16px;
            padding: 32px 24px;
            border-radius: 3px;
        }

        #message h2 {
            color: #ffa100;
            font-weight: bold;
            font-size: 16px;
            margin: 0 0 8px;
        }

        #message h1 {
            font-size: 22px;
            font-weight: 300;
            color: rgba(0, 0, 0, 0.6);
            margin: 0 0 16px;
        }

        #message p {
            line-height: 140%;
            margin: 16px 0 24px;
            font-size: 14px;
        }

        #message a {
            display: block;
            text-align: center;
            background: #039be5;
            text-transform: uppercase;
            text-decoration: none;
            color: white;
            padding: 16px;
            border-radius: 4px;
        }

        #message,
        #message a {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }

        #load {
            color: rgba(0, 0, 0, 0.4);
            text-align: center;
            font-size: 13px;
        }

        div {
            border-top: 1px dotted grey;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        @media (max-width: 600px) {

            body,
            #message {
                margin-top: 0;
                background: white;
                box-shadow: none;
            }

            body {
                border-top: 16px solid #ffa100;
            }
        }

        span {
            border: 1px solid;
            margin: 4px;
            padding: 2px;
        }

        input {
            max-width: 60px;
            display: inline-block;
        }

        label {
            font-weight: bold;
            /* display: block; */
        }

        #status {
            height: 1em;
        }
    </style>
</head>

<body>
    <!-- <label>Hello</label> -->
    <div id="message">
        <a href="https://kite.trade/connect/login?api_key=7zx0e8g535qgefu6&v=3">New request_token</a>
        <div id="status"></div>
        <div>
            <label>Stop exe</label>
            <button id='hold_exe'>Loading</button>
        </div>
        <div>
            <label>Directional exe</label>
            <button id='directional_exe'>Loading</button>
        </div>
        <div>
            <label>Boundary exe</label>
            <button id='boundary_exe'>Loading</button>
        </div>
        <br>
        <div>
            <div>Strike range</div>

            <div>CURRENT_WEEK</div>
            <label>ALL</label><input id="CURRENT_WEEK_ALL" type="checkbox">
            <BR>
            <label>LOW</label><input id="CURRENT_WEEK_LOW" type="number">
            <label>HIGH</label><input id="CURRENT_WEEK_HIGH" type="number">
            <button id="BTN_CURRENT_WEEK">Update</button>

            <div>NEXT_WEEK</div>
            <label>ALL</label><input id="NEXT_WEEK_ALL" type="checkbox">
            <BR>
            <label>LOW</label><input id="NEXT_WEEK_LOW" type="number">
            <label>HIGH</label><input id="NEXT_WEEK_HIGH" type="number">
            <button id="BTN_NEXT_WEEK">Update</button>

            <div>CURRENT_MONTH</div>
            <label>ALL</label><input id="CURRENT_MONTH_ALL" type="checkbox">
            <BR>
            <label>LOW</label><input id="CURRENT_MONTH_LOW" type="number">
            <label>HIGH</label><input id="CURRENT_MONTH_HIGH" type="number">
            <button id="BTN_CURRENT_MONTH">Update</button>

        </div>
        <div>
            <label>Option range</label>
            <div>
                <input id="option1" type="number">
                <input id="option2" type="number">
                <button id="btnOption">Update option range</button>
            </div>
        </div>
        <!-- <div>
            <div>
                <label>OPTION_MD</label> <span id="OPTION_MD"></span>
            </div>
            <input id="MD_UPDATE">
            <button id="BTN_OPTION_MD_REMOVE">Remove</button>
            <button id="BTN_OPTION_MD_ADD">Add</button>
        </div> -->
        <div>
            <label>NIFTYBANK_QTY</label>
            <input id="NIFTYBANK_QTY" type="number">
            <button id="BTN_NIFTYBANK_QTY">update</button>
        </div>
        <div>
            <label>OPEN_ORDER_EXPIRY_MIN</label>
            <input id="OPEN_ORDER_EXPIRY_MIN" type="number">
            <button id="BTN_OPEN_ORDER_EXPIRY_MIN">update</button>
        </div>
        <div>
            <label>ENTRY_STOP_PC</label>
            <input id="ENTRY_STOP_PC" type="number">
            <button id="BTN_ENTRY_STOP_PC">update</button>
        </div>
        <div>
            <label>STOP_PC</label>
            <input id="STOP_PC" type="number">
            <button id="BTN_STOP_PC">update</button>
        </div>
        <div>
            <label>TRAIL_RATIO</label>
            <input id="TRAIL_RATIO" type="number">
            <button id="BTN_TRAIL_RATIO">update</button>
        </div>
        <div>
            <label>TRAIL_BUFFER_PC</label>
            <input id="TRAIL_BUFFER_PC" type="number">
            <button id="BTN_TRAIL_BUFFER_PC">update</button>
        </div>
        <div>
            <label>TRIGGER_GAP</label>
            <input id="TRIGGER_GAP" type="number">
            <button id="BTN_TRIGGER_GAP">update</button>
        </div>
        <div>
            <label>CANDLE_MOMENTUM_PC</label>
            <input id="CANDLE_MOMENTUM_PC" type="number">
            <button id="BTN_CANDLE_MOMENTUM_PC">update</button>
        </div>
        <div>
            <label>OHLC_MIN</label>
            <input id="OHLC_MIN" type="number">
            <button id="BTN_OHLC_MIN">update</button>
        </div>
        <div>
            <label>EXTREMA_ORDER</label>
            <input id="EXTREMA_ORDER" type="number">
            <button id="BTN_EXTREMA_ORDER">update</button>
        </div>
        <div>
            <label>EXTREMA_WINDOW</label>
            <input id="EXTREMA_WINDOW" type="number">
            <button id="BTN_EXTREMA_WINDOW">update</button>
        </div>
        <div>
            <label>EXTREMA_GAP</label>
            <input id="EXTREMA_GAP" type="number">
            <button id="BTN_EXTREMA_GAP">update</button>
        </div>
        <div>
            <label>FREQ_CUTOFF_FACTOR</label>
            <input id="FREQ_CUTOFF_FACTOR" type="number">
            <button id="BTN_FREQ_CUTOFF_FACTOR">update</button>
        </div>

        <div>
            <label>TREND_ANGLE</label>
            <input id="TREND_ANGLE" type="number">
            <button id="BTN_TREND_ANGLE">update</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const loadEl = document.querySelector('#load');
            const btn_hold_exe = document.querySelector('#hold_exe')
            const btn_directional_exe = document.querySelector('#directional_exe')
            const btn_boundary_exe = document.querySelector('#boundary_exe')

            // const strike1 = document.querySelector('#strike1')
            // const strike2 = document.querySelector('#strike2')
            // const btnstrike = document.querySelector('#btnstrike')

            const option1 = document.querySelector('#option1')
            const option2 = document.querySelector('#option2')
            const btnoption = document.querySelector('#btnOption')

            const el_OPTION_MD = document.querySelector('#OPTION_MD')
            const IN_OPEN_ORDER_EXPIRY_MIN = document.querySelector('#OPEN_ORDER_EXPIRY_MIN')
            const BTN_OPEN_ORDER_EXPIRY_MIN = document.querySelector('#BTN_OPEN_ORDER_EXPIRY_MIN')

            const IN_NIFTYBANK_QTY = document.querySelector('#NIFTYBANK_QTY')
            const BTN_NIFTYBANK_QTY = document.querySelector('#BTN_NIFTYBANK_QTY')

            const ENTRY_STOP_PC = document.querySelector('#ENTRY_STOP_PC')
            const BTN_ENTRY_STOP_PC = document.querySelector('#BTN_ENTRY_STOP_PC')

            const STOP_PC = document.querySelector('#STOP_PC')
            const BTN_STOP_PC = document.querySelector('#BTN_STOP_PC')

            const TRAIL_RATIO = document.querySelector('#TRAIL_RATIO')
            const BTN_TRAIL_RATIO = document.querySelector('#BTN_TRAIL_RATIO')

            const TRAIL_BUFFER_PC = document.querySelector('#TRAIL_BUFFER_PC')
            const BTN_TRAIL_BUFFER_PC = document.querySelector('#BTN_TRAIL_BUFFER_PC')


            const TRIGGER_GAP = document.querySelector('#TRIGGER_GAP')
            const BTN_TRIGGER_GAP = document.querySelector('#BTN_TRIGGER_GAP')

            // const EL_MD_UPDATE = document.querySelector('#MD_UPDATE')
            // const BTN_OPTION_MD_REMOVE = document.querySelector('#BTN_OPTION_MD_REMOVE')
            // const BTN_OPTION_MD_ADD = document.querySelector('#BTN_OPTION_MD_ADD')

            const elstatus = document.querySelector('#status')

            const CANDLE_MOMENTUM_PC = document.querySelector('#CANDLE_MOMENTUM_PC')
            const BTN_CANDLE_MOMENTUM_PC = document.querySelector('#BTN_CANDLE_MOMENTUM_PC')

            const OHLC_MIN = document.querySelector('#OHLC_MIN')
            const BTN_OHLC_MIN = document.querySelector('#BTN_OHLC_MIN')

            const EXTREMA_ORDER = document.querySelector('#EXTREMA_ORDER')
            const BTN_EXTREMA_ORDER = document.querySelector('#BTN_EXTREMA_ORDER')

            const EXTREMA_WINDOW = document.querySelector('#EXTREMA_WINDOW')
            const BTN_EXTREMA_WINDOW = document.querySelector('#BTN_EXTREMA_WINDOW')

            const EXTREMA_GAP = document.querySelector('#EXTREMA_GAP')
            const BTN_EXTREMA_GAP = document.querySelector('#BTN_EXTREMA_GAP')

            const FREQ_CUTOFF_FACTOR = document.querySelector('#FREQ_CUTOFF_FACTOR')
            const BTN_FREQ_CUTOFF_FACTOR = document.querySelector('#BTN_FREQ_CUTOFF_FACTOR')

            const TREND_ANGLE = document.querySelector('#TREND_ANGLE')
            const BTN_TREND_ANGLE = document.querySelector('#BTN_TREND_ANGLE')

            const CURRENT_MONTH_ALL = document.querySelector('#CURRENT_MONTH_ALL')
            const CURRENT_MONTH_LOW = document.querySelector('#CURRENT_MONTH_LOW')
            const CURRENT_MONTH_HIGH = document.querySelector('#CURRENT_MONTH_HIGH')
            const BTN_CURRENT_MONTH = document.querySelector('#BTN_CURRENT_MONTH')

            const CURRENT_WEEK_ALL = document.querySelector('#CURRENT_WEEK_ALL')
            const CURRENT_WEEK_LOW = document.querySelector('#CURRENT_WEEK_LOW')
            const CURRENT_WEEK_HIGH = document.querySelector('#CURRENT_WEEK_HIGH')
            const BTN_CURRENT_WEEK = document.querySelector('#BTN_CURRENT_WEEK')

            const NEXT_WEEK_ALL = document.querySelector('#NEXT_WEEK_ALL')
            const NEXT_WEEK_LOW = document.querySelector('#NEXT_WEEK_LOW')
            const NEXT_WEEK_HIGH = document.querySelector('#NEXT_WEEK_HIGH')
            const BTN_NEXT_WEEK = document.querySelector('#BTN_NEXT_WEEK')

            var showStatus = function () {
                elstatus.textContent = 'Updating...'
                setTimeout(() => {
                    elstatus.textContent = 'Updated'
                    setTimeout(() => {
                        elstatus.textContent = ''
                    }, 2000);
                }, 2000);
            }
            try {
                //   let app = firebase.app();
                var db = firebase.firestore();
                let params = (new URL(document.location)).searchParams;
                let request_token = params.get('request_token')
                console.log(request_token)
                if (request_token) {
                    db.collection('configs').doc('VIp4hCZGXPOqyJMNDc6H').update({ request_token: request_token })
                }

                var configsRef = db.collection("configs").doc("VIp4hCZGXPOqyJMNDc6H");
                var hold_exe = null
                // var option_md = null
                configsRef.onSnapshot((doc) => {
                    data = doc.data()
                    console.log("Current data: ", data);
                    hold_exe = data['HOLD_EXE'];
                    btn_hold_exe.textContent = hold_exe;

                    directional_exe = data['DIRECTIONAL_EXE'];
                    btn_directional_exe.textContent = directional_exe;

                    boundary_exe = data['BOUNDARY_EXE'];
                    btn_boundary_exe.textContent = boundary_exe;
                    
                    CURRENT_MONTH_ALL.checked = data['STRIKES']['CURRENT_MONTH']['ALL']
                    CURRENT_MONTH_LOW.value = data['STRIKES']['CURRENT_MONTH']['LOW']
                    CURRENT_MONTH_HIGH.value = data['STRIKES']['CURRENT_MONTH']['HIGH']

                    CURRENT_WEEK_ALL.checked = data['STRIKES']['CURRENT_WEEK']['ALL']
                    CURRENT_WEEK_LOW.value = data['STRIKES']['CURRENT_WEEK']['LOW']
                    CURRENT_WEEK_HIGH.value = data['STRIKES']['CURRENT_WEEK']['HIGH']

                    NEXT_WEEK_ALL.checked = data['STRIKES']['NEXT_WEEK']['ALL']
                    NEXT_WEEK_LOW.value = data['STRIKES']['NEXT_WEEK']['LOW']
                    NEXT_WEEK_HIGH.value = data['STRIKES']['NEXT_WEEK']['HIGH']

                    option_range = data['OPTION_PRICE_RANGE'];
                    option1.value = option_range[0];
                    option2.value = option_range[1];

                    // option_md = data['OPTION_MD']
                    // el_OPTION_MD.textContent = option_md
                    IN_OPEN_ORDER_EXPIRY_MIN.value = data['OPEN_ORDER_EXPIRY_MIN'];
                    if('NIFTYBANK_QTY' in data){
                        IN_NIFTYBANK_QTY.value = data['NIFTYBANK_QTY'];
                    }else{
                        IN_NIFTYBANK_QTY.value = 25;
                    }

                    ENTRY_STOP_PC.value = data['ENTRY_STOP_PC'];
                    STOP_PC.value = data['STOP_PC'];
                    TRAIL_RATIO.value = data['TRAIL_RATIO'];
                    TRAIL_BUFFER_PC.value = data['TRAIL_BUFFER_PC'];
                    TRIGGER_GAP.value = data['TRIGGER_GAP'];
                    CANDLE_MOMENTUM_PC.value = data['CANDLE_MOMENTUM_PC'];
                    OHLC_MIN.value = data['OHLC_MIN'];
                    EXTREMA_ORDER.value = data['EXTREMA_ORDER'];
                    EXTREMA_WINDOW.value = data['EXTREMA_WINDOW'];
                    EXTREMA_GAP.value = data['EXTREMA_GAP'];
                    FREQ_CUTOFF_FACTOR.value = data['FREQ_CUTOFF_FACTOR'];
                    TREND_ANGLE.value = data['TREND_ANGLE'];
                });

                btn_hold_exe.onclick = function () {
                    configsRef.update({ HOLD_EXE: !hold_exe })
                    showStatus()
                }

                BTN_EXTREMA_WINDOW.onclick = function () {
                    configsRef.update({ EXTREMA_WINDOW: parseInt(EXTREMA_WINDOW.value) })
                    showStatus()
                }

                BTN_EXTREMA_GAP.onclick = function () {
                    configsRef.update({ EXTREMA_GAP: parseInt(EXTREMA_GAP.value) })
                    showStatus()
                }
                btn_directional_exe.onclick = function () {
                    configsRef.update({ DIRECTIONAL_EXE: !directional_exe })
                    showStatus()
                }
                btn_boundary_exe.onclick = function () {
                    configsRef.update({ BOUNDARY_EXE: !boundary_exe })
                    showStatus()
                }
                // btnstrike.onclick = function () {

                //     configsRef.update({ STRIKE_RANGE: { 'SPAN': parseInt(strike1.value), 'SKIP': parseInt(strike2.value) } })
                //     showStatus()
                // }
                btnOption.onclick = function () {

                    configsRef.update({ OPTION_PRICE_RANGE: [parseFloat(option1.value), parseFloat(option2.value)] })
                    showStatus()
                }
                BTN_OPEN_ORDER_EXPIRY_MIN.onclick = function () {

                    configsRef.update({ OPEN_ORDER_EXPIRY_MIN: parseInt(IN_OPEN_ORDER_EXPIRY_MIN.value) })
                    showStatus()
                }
                BTN_NIFTYBANK_QTY.onclick = function () {

                    configsRef.update({ NIFTYBANK_QTY: parseInt(IN_NIFTYBANK_QTY.value) })
                    showStatus()
                }
                BTN_ENTRY_STOP_PC.onclick = function () {

                    configsRef.update({ ENTRY_STOP_PC: parseFloat(ENTRY_STOP_PC.value) })
                    showStatus()
                }

                BTN_STOP_PC.onclick = function () {

                    configsRef.update({ STOP_PC: parseFloat(STOP_PC.value) })
                    showStatus()
                }

                BTN_TRAIL_RATIO.onclick = function () {

                    configsRef.update({ TRAIL_RATIO: parseFloat(TRAIL_RATIO.value) })
                    showStatus()
                }

                BTN_TRAIL_BUFFER_PC.onclick = function () {

                    configsRef.update({ TRAIL_BUFFER_PC: parseFloat(TRAIL_BUFFER_PC.value) })
                    showStatus()
                }
                BTN_TRIGGER_GAP.onclick = function () {

                    configsRef.update({ TRIGGER_GAP: parseFloat(TRIGGER_GAP.value) })
                    showStatus()
                }
                BTN_CANDLE_MOMENTUM_PC.onclick = function () {

                    configsRef.update({ CANDLE_MOMENTUM_PC: parseFloat(CANDLE_MOMENTUM_PC.value) })
                    showStatus()
                }

                BTN_OHLC_MIN.onclick = function () {

                    configsRef.update({ OHLC_MIN: parseInt(OHLC_MIN.value) })
                    showStatus()
                }
                BTN_EXTREMA_ORDER.onclick = function () {

                    configsRef.update({ EXTREMA_ORDER: parseInt(EXTREMA_ORDER.value) })
                    showStatus()
                }

                BTN_FREQ_CUTOFF_FACTOR.onclick = function () {

                    configsRef.update({ FREQ_CUTOFF_FACTOR: parseFloat(FREQ_CUTOFF_FACTOR.value) })
                    showStatus()
                }

                BTN_TREND_ANGLE.onclick = function () {

                    configsRef.update({ TREND_ANGLE: parseFloat(TREND_ANGLE.value) })
                    showStatus()
                }
                CURRENT_MONTH_ALL.onclick = function () {
                    configsRef.update({ "STRIKES.CURRENT_MONTH.ALL": CURRENT_MONTH_ALL.checked })
                }
                BTN_CURRENT_MONTH.onclick = function () {
                    configsRef.update({ "STRIKES.CURRENT_MONTH.LOW": parseInt(CURRENT_MONTH_LOW.value), "STRIKES.CURRENT_MONTH.HIGH": parseInt(CURRENT_MONTH_HIGH.value) })
                    showStatus()
                }

                CURRENT_WEEK_ALL.onclick = function () {
                    configsRef.update({ "STRIKES.CURRENT_WEEK.ALL": CURRENT_WEEK_ALL.checked })
                }
                BTN_CURRENT_WEEK.onclick = function () {
                    configsRef.update({ "STRIKES.CURRENT_WEEK.LOW": parseInt(CURRENT_WEEK_LOW.value), "STRIKES.CURRENT_MONTH.HIGH": parseInt(CURRENT_MONTH_HIGH.value) })
                    showStatus()
                }

                NEXT_WEEK_ALL.onclick = function () {
                    configsRef.update({ "STRIKES.NEXT_WEEK.ALL": NEXT_WEEK_ALL.checked })
                }
                BTN_NEXT_WEEK.onclick = function () {
                    configsRef.update({ "STRIKES.NEXT_WEEK.LOW": parseInt(NEXT_WEEK_LOW.value), "STRIKES.NEXT_WEEK.HIGH": parseInt(NEXT_WEEK_HIGH.value) })
                    showStatus()
                }

                // BTN_OPTION_MD_REMOVE.onclick = function () {
                //     valuetoRemove = EL_MD_UPDATE.value
                //     configsRef.update({ OPTION_MD: firebase.firestore.FieldValue.arrayRemove(valuetoRemove) })
                //     EL_MD_UPDATE.value = null
                //     showStatus()
                // }
                // BTN_OPTION_MD_ADD.onclick = function () {
                //     valuetoAdd = EL_MD_UPDATE.value
                //     configsRef.update({ OPTION_MD: firebase.firestore.FieldValue.arrayUnion(valuetoAdd) })
                //     EL_MD_UPDATE.value = null
                //     showStatus()
                // }


            } catch (e) {
                console.error(e);
                loadEl.textContent = 'Error loading the Firebase SDK, check the console.';
            }
        });
    </script>
</body>

</html>